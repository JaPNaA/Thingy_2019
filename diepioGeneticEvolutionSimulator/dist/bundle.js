!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=2)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(1),n=function(t,e,i){this.dx=-e-t*s.SQUISH_2D,this.dy=-i-t*s.SQUISH_2D,this.xsb=e,this.ysb=i},a=function(t,e,i,n){this.dx=-e-t*s.SQUISH_3D,this.dy=-i-t*s.SQUISH_3D,this.dz=-n-t*s.SQUISH_3D,this.xsb=e,this.ysb=i,this.zsb=n},h=function(t,e,i,n,a){this.dx=-e-t*s.SQUISH_4D,this.dy=-i-t*s.SQUISH_4D,this.dz=-n-t*s.SQUISH_4D,this.dw=-a-t*s.SQUISH_4D,this.xsb=e,this.ysb=i,this.zsb=n,this.wsb=a};function r(t){var e=new Uint32Array(1);return e[0]=1664525*t[0]+1013904223,e}var o=function(){function t(t){this.initialize(),this.perm=new Uint8Array(256),this.perm2D=new Uint8Array(256),this.perm3D=new Uint8Array(256),this.perm4D=new Uint8Array(256);for(var e=new Uint8Array(256),i=0;i<256;i++)e[i]=i;var s=new Uint32Array(1);s[0]=t,s=r(r(r(s)));for(i=255;i>=0;i--){s=r(s);var n=new Uint32Array(1);n[0]=(s[0]+31)%(i+1),n[0]<0&&(n[0]+=i+1),this.perm[i]=e[n[0]],this.perm2D[i]=14&this.perm[i],this.perm3D[i]=this.perm[i]%24*3,this.perm4D[i]=252&this.perm[i],e[n[0]]=e[i]}}return t.prototype.array2D=function(t,e){for(var i=new Array(t),s=0;s<t;s++){i[s]=new Array(e);for(var n=0;n<e;n++)i[s][n]=this.noise2D(s,n)}return i},t.prototype.array3D=function(t,e,i){for(var s=new Array(t),n=0;n<t;n++){s[n]=new Array(e);for(var a=0;a<e;a++){s[n][a]=new Array(i);for(var h=0;h<i;h++)s[n][a][h]=this.noise3D(n,a,h)}}return s},t.prototype.array4D=function(t,e,i,s){for(var n=new Array(t),a=0;a<t;a++){n[a]=new Array(e);for(var h=0;h<e;h++){n[a][h]=new Array(i);for(var r=0;r<i;r++){n[a][h][r]=new Array(s);for(var o=0;o<s;o++)n[a][h][r][o]=this.noise4D(a,h,r,o)}}}return n},t.prototype.noise2D=function(t,e){for(var i=(t+e)*s.STRETCH_2D,n=t+i,a=e+i,h=Math.floor(n),r=Math.floor(a),o=(h+r)*s.SQUISH_2D,l=t-(h+o),d=e-(r+o),c=n-h,u=a-r,m=c+u,p=c-u+1|m<<1|m+u<<2|m+c<<4,f=0,g=this.lookup2D[p];void 0!==g;g=g.next){var v=l+g.dx,y=d+g.dy,b=2-v*v-y*y;if(b>0){var x=h+g.xsb,M=r+g.ysb,T=this.perm[255&x],w=this.perm2D[T+M&255];f+=b*b*b*b*(s.gradients2D[w]*v+s.gradients2D[w+1]*y)}}return f*s.NORM_2D},t.prototype.noise3D=function(t,e,i){for(var n=(t+e+i)*s.STRETCH_3D,a=t+n,h=e+n,r=i+n,o=Math.floor(a),l=Math.floor(h),d=Math.floor(r),c=(o+l+d)*s.SQUISH_3D,u=t-(o+c),m=e-(l+c),p=i-(d+c),f=a-o,g=h-l,v=r-d,y=f+g+v,b=g-v+1|f-g+1<<1|f-v+1<<2|y<<3|y+v<<5|y+g<<7|y+f<<9,x=0,M=this.lookup3D[b];void 0!==M;M=M.next){var T=u+M.dx,w=m+M.dy,D=p+M.dz,S=2-T*T-w*w-D*D;if(S>0){var H=o+M.xsb,k=l+M.ysb,C=d+M.zsb,I=this.perm[255&H],P=this.perm[I+k&255],R=this.perm3D[P+C&255];x+=S*S*S*S*(s.gradients3D[R]*T+s.gradients3D[R+1]*w+s.gradients3D[R+2]*D)}}return x*s.NORM_3D},t.prototype.noise4D=function(t,e,i,n){for(var a=(t+e+i+n)*s.STRETCH_4D,h=t+a,r=e+a,o=i+a,l=n+a,d=Math.floor(h),c=Math.floor(r),u=Math.floor(o),m=Math.floor(l),p=(d+c+u+m)*s.SQUISH_4D,f=t-(d+p),g=e-(c+p),v=i-(u+p),y=n-(m+p),b=h-d,x=r-c,M=o-u,T=l-m,w=b+x+M+T,D=M-T+1|x-M+1<<1|x-T+1<<2|b-x+1<<3|b-M+1<<4|b-T+1<<5|w<<6|w+T<<8|w+M<<11|w+x<<14|w+b<<17,S=0,H=this.lookup4D[D];void 0!==H;H=H.next){var k=f+H.dx,C=g+H.dy,I=v+H.dz,P=y+H.dw,R=2-k*k-C*C-I*I-P*P;if(R>0){var E=d+H.xsb,L=c+H.ysb,X=u+H.zsb,_=m+H.wsb,A=this.perm[255&E],z=this.perm[A+L&255],q=this.perm[z+X&255],B=this.perm4D[q+_&255];S+=R*R*R*R*(s.gradients4D[B]*k+s.gradients4D[B+1]*C+s.gradients4D[B+2]*I+s.gradients4D[B+3]*P)}}return S*s.NORM_4D},t.prototype.initialize=function(){for(var t=[],e=0;e<s.p2D.length;e+=4){for(var i=s.base2D[s.p2D[e]],r=null,o=null,l=0;l<i.length;l+=3)o=new n(i[l],i[l+1],i[l+2]),null===r?t[e/4]=o:r.next=o,r=o;o.next=new n(s.p2D[e+1],s.p2D[e+2],s.p2D[e+3])}this.lookup2D=[];for(e=0;e<s.lookupPairs2D.length;e+=2)this.lookup2D[s.lookupPairs2D[e]]=t[s.lookupPairs2D[e+1]];var d=[];for(e=0;e<s.p3D.length;e+=9){for(i=s.base3D[s.p3D[e]],r=null,o=null,l=0;l<i.length;l+=4)o=new a(i[l],i[l+1],i[l+2],i[l+3]),null===r?d[e/9]=o:r.next=o,r=o;o.next=new a(s.p3D[e+1],s.p3D[e+2],s.p3D[e+3],s.p3D[e+4]),o.next.next=new a(s.p3D[e+5],s.p3D[e+6],s.p3D[e+7],s.p3D[e+8])}this.lookup3D=[];for(e=0;e<s.lookupPairs3D.length;e+=2)this.lookup3D[s.lookupPairs3D[e]]=d[s.lookupPairs3D[e+1]];var c=[];for(e=0;e<s.p4D.length;e+=16){for(i=s.base4D[s.p4D[e]],r=null,o=null,l=0;l<i.length;l+=5)o=new h(i[l],i[l+1],i[l+2],i[l+3],i[l+4]),null===r?c[e/16]=o:r.next=o,r=o;o.next=new h(s.p4D[e+1],s.p4D[e+2],s.p4D[e+3],s.p4D[e+4],s.p4D[e+5]),o.next.next=new h(s.p4D[e+6],s.p4D[e+7],s.p4D[e+8],s.p4D[e+9],s.p4D[e+10]),o.next.next.next=new h(s.p4D[e+11],s.p4D[e+12],s.p4D[e+13],s.p4D[e+14],s.p4D[e+15])}this.lookup4D=[];for(e=0;e<s.lookupPairs4D.length;e+=2)this.lookup4D[s.lookupPairs4D[e]]=c[s.lookupPairs4D[e+1]]},t}();e.default=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.NORM_2D=1/47,e.NORM_3D=1/103,e.NORM_4D=1/30,e.SQUISH_2D=(Math.sqrt(3)-1)/2,e.SQUISH_3D=(Math.sqrt(4)-1)/3,e.SQUISH_4D=(Math.sqrt(5)-1)/4,e.STRETCH_2D=(1/Math.sqrt(3)-1)/2,e.STRETCH_3D=(1/Math.sqrt(4)-1)/3,e.STRETCH_4D=(1/Math.sqrt(5)-1)/4,e.base2D=[[1,1,0,1,0,1,0,0,0],[1,1,0,1,0,1,2,1,1]],e.base3D=[[0,0,0,0,1,1,0,0,1,0,1,0,1,0,0,1],[2,1,1,0,2,1,0,1,2,0,1,1,3,1,1,1],[1,1,0,0,1,0,1,0,1,0,0,1,2,1,1,0,2,1,0,1,2,0,1,1]],e.base4D=[[0,0,0,0,0,1,1,0,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,0,1],[3,1,1,1,0,3,1,1,0,1,3,1,0,1,1,3,0,1,1,1,4,1,1,1,1],[1,1,0,0,0,1,0,1,0,0,1,0,0,1,0,1,0,0,0,1,2,1,1,0,0,2,1,0,1,0,2,1,0,0,1,2,0,1,1,0,2,0,1,0,1,2,0,0,1,1],[3,1,1,1,0,3,1,1,0,1,3,1,0,1,1,3,0,1,1,1,2,1,1,0,0,2,1,0,1,0,2,1,0,0,1,2,0,1,1,0,2,0,1,0,1,2,0,0,1,1]],e.gradients2D=[5,2,2,5,-5,2,-2,5,5,-2,2,-5,-5,-2,-2,-5],e.gradients3D=[-11,4,4,-4,11,4,-4,4,11,11,4,4,4,11,4,4,4,11,-11,-4,4,-4,-11,4,-4,-4,11,11,-4,4,4,-11,4,4,-4,11,-11,4,-4,-4,11,-4,-4,4,-11,11,4,-4,4,11,-4,4,4,-11,-11,-4,-4,-4,-11,-4,-4,-4,-11,11,-4,-4,4,-11,-4,4,-4,-11],e.gradients4D=[3,1,1,1,1,3,1,1,1,1,3,1,1,1,1,3,-3,1,1,1,-1,3,1,1,-1,1,3,1,-1,1,1,3,3,-1,1,1,1,-3,1,1,1,-1,3,1,1,-1,1,3,-3,-1,1,1,-1,-3,1,1,-1,-1,3,1,-1,-1,1,3,3,1,-1,1,1,3,-1,1,1,1,-3,1,1,1,-1,3,-3,1,-1,1,-1,3,-1,1,-1,1,-3,1,-1,1,-1,3,3,-1,-1,1,1,-3,-1,1,1,-1,-3,1,1,-1,-1,3,-3,-1,-1,1,-1,-3,-1,1,-1,-1,-3,1,-1,-1,-1,3,3,1,1,-1,1,3,1,-1,1,1,3,-1,1,1,1,-3,-3,1,1,-1,-1,3,1,-1,-1,1,3,-1,-1,1,1,-3,3,-1,1,-1,1,-3,1,-1,1,-1,3,-1,1,-1,1,-3,-3,-1,1,-1,-1,-3,1,-1,-1,-1,3,-1,-1,-1,1,-3,3,1,-1,-1,1,3,-1,-1,1,1,-3,-1,1,1,-1,-3,-3,1,-1,-1,-1,3,-1,-1,-1,1,-3,-1,-1,1,-1,-3,3,-1,-1,-1,1,-3,-1,-1,1,-1,-3,-1,1,-1,-1,-3,-3,-1,-1,-1,-1,-3,-1,-1,-1,-1,-3,-1,-1,-1,-1,-3],e.lookupPairs2D=[0,1,1,0,4,1,17,0,20,2,21,2,22,5,23,5,26,4,39,3,42,4,43,3],e.lookupPairs3D=[0,2,1,1,2,2,5,1,6,0,7,0,32,2,34,2,129,1,133,1,160,5,161,5,518,0,519,0,546,4,550,4,645,3,647,3,672,5,673,5,674,4,677,3,678,4,679,3,680,13,681,13,682,12,685,14,686,12,687,14,712,20,714,18,809,21,813,23,840,20,841,21,1198,19,1199,22,1226,18,1230,19,1325,23,1327,22,1352,15,1353,17,1354,15,1357,17,1358,16,1359,16,1360,11,1361,10,1362,11,1365,10,1366,9,1367,9,1392,11,1394,11,1489,10,1493,10,1520,8,1521,8,1878,9,1879,9,1906,7,1910,7,2005,6,2007,6,2032,8,2033,8,2034,7,2037,6,2038,7,2039,6],e.lookupPairs4D=[0,3,1,2,2,3,5,2,6,1,7,1,8,3,9,2,10,3,13,2,16,3,18,3,22,1,23,1,24,3,26,3,33,2,37,2,38,1,39,1,41,2,45,2,54,1,55,1,56,0,57,0,58,0,59,0,60,0,61,0,62,0,63,0,256,3,258,3,264,3,266,3,272,3,274,3,280,3,282,3,2049,2,2053,2,2057,2,2061,2,2081,2,2085,2,2089,2,2093,2,2304,9,2305,9,2312,9,2313,9,16390,1,16391,1,16406,1,16407,1,16422,1,16423,1,16438,1,16439,1,16642,8,16646,8,16658,8,16662,8,18437,6,18439,6,18469,6,18471,6,18688,9,18689,9,18690,8,18693,6,18694,8,18695,6,18696,9,18697,9,18706,8,18710,8,18725,6,18727,6,131128,0,131129,0,131130,0,131131,0,131132,0,131133,0,131134,0,131135,0,131352,7,131354,7,131384,7,131386,7,133161,5,133165,5,133177,5,133181,5,133376,9,133377,9,133384,9,133385,9,133400,7,133402,7,133417,5,133421,5,133432,7,133433,5,133434,7,133437,5,147510,4,147511,4,147518,4,147519,4,147714,8,147718,8,147730,8,147734,8,147736,7,147738,7,147766,4,147767,4,147768,7,147770,7,147774,4,147775,4,149509,6,149511,6,149541,6,149543,6,149545,5,149549,5,149558,4,149559,4,149561,5,149565,5,149566,4,149567,4,149760,9,149761,9,149762,8,149765,6,149766,8,149767,6,149768,9,149769,9,149778,8,149782,8,149784,7,149786,7,149797,6,149799,6,149801,5,149805,5,149814,4,149815,4,149816,7,149817,5,149818,7,149821,5,149822,4,149823,4,149824,37,149825,37,149826,36,149829,34,149830,36,149831,34,149832,37,149833,37,149842,36,149846,36,149848,35,149850,35,149861,34,149863,34,149865,33,149869,33,149878,32,149879,32,149880,35,149881,33,149882,35,149885,33,149886,32,149887,32,150080,49,150082,48,150088,49,150098,48,150104,47,150106,47,151873,46,151877,45,151881,46,151909,45,151913,44,151917,44,152128,49,152129,46,152136,49,152137,46,166214,43,166215,42,166230,43,166247,42,166262,41,166263,41,166466,48,166470,43,166482,48,166486,43,168261,45,168263,42,168293,45,168295,42,168512,31,168513,28,168514,31,168517,28,168518,25,168519,25,280952,40,280953,39,280954,40,280957,39,280958,38,280959,38,281176,47,281178,47,281208,40,281210,40,282985,44,282989,44,283001,39,283005,39,283208,30,283209,27,283224,30,283241,27,283256,22,283257,22,297334,41,297335,41,297342,38,297343,38,297554,29,297558,24,297562,29,297590,24,297594,21,297598,21,299365,26,299367,23,299373,26,299383,23,299389,20,299391,20,299584,31,299585,28,299586,31,299589,28,299590,25,299591,25,299592,30,299593,27,299602,29,299606,24,299608,30,299610,29,299621,26,299623,23,299625,27,299629,26,299638,24,299639,23,299640,22,299641,22,299642,21,299645,20,299646,21,299647,20,299648,61,299649,60,299650,61,299653,60,299654,59,299655,59,299656,58,299657,57,299666,55,299670,54,299672,58,299674,55,299685,52,299687,51,299689,57,299693,52,299702,54,299703,51,299704,56,299705,56,299706,53,299709,50,299710,53,299711,50,299904,61,299906,61,299912,58,299922,55,299928,58,299930,55,301697,60,301701,60,301705,57,301733,52,301737,57,301741,52,301952,79,301953,79,301960,76,301961,76,316038,59,316039,59,316054,54,316071,51,316086,54,316087,51,316290,78,316294,78,316306,73,316310,73,318085,77,318087,77,318117,70,318119,70,318336,79,318337,79,318338,78,318341,77,318342,78,318343,77,430776,56,430777,56,430778,53,430781,50,430782,53,430783,50,431e3,75,431002,72,431032,75,431034,72,432809,74,432813,69,432825,74,432829,69,433032,76,433033,76,433048,75,433065,74,433080,75,433081,74,447158,71,447159,68,447166,71,447167,68,447378,73,447382,73,447386,72,447414,71,447418,72,447422,71,449189,70,449191,70,449197,69,449207,68,449213,69,449215,68,449408,67,449409,67,449410,66,449413,64,449414,66,449415,64,449416,67,449417,67,449426,66,449430,66,449432,65,449434,65,449445,64,449447,64,449449,63,449453,63,449462,62,449463,62,449464,65,449465,63,449466,65,449469,63,449470,62,449471,62,449472,19,449473,19,449474,18,449477,16,449478,18,449479,16,449480,19,449481,19,449490,18,449494,18,449496,17,449498,17,449509,16,449511,16,449513,15,449517,15,449526,14,449527,14,449528,17,449529,15,449530,17,449533,15,449534,14,449535,14,449728,19,449729,19,449730,18,449734,18,449736,19,449737,19,449746,18,449750,18,449752,17,449754,17,449784,17,449786,17,451520,19,451521,19,451525,16,451527,16,451528,19,451529,19,451557,16,451559,16,451561,15,451565,15,451577,15,451581,15,451776,19,451777,19,451784,19,451785,19,465858,18,465861,16,465862,18,465863,16,465874,18,465878,18,465893,16,465895,16,465910,14,465911,14,465918,14,465919,14,466114,18,466118,18,466130,18,466134,18,467909,16,467911,16,467941,16,467943,16,468160,13,468161,13,468162,13,468163,13,468164,13,468165,13,468166,13,468167,13,580568,17,580570,17,580585,15,580589,15,580598,14,580599,14,580600,17,580601,15,580602,17,580605,15,580606,14,580607,14,580824,17,580826,17,580856,17,580858,17,582633,15,582637,15,582649,15,582653,15,582856,12,582857,12,582872,12,582873,12,582888,12,582889,12,582904,12,582905,12,596982,14,596983,14,596990,14,596991,14,597202,11,597206,11,597210,11,597214,11,597234,11,597238,11,597242,11,597246,11,599013,10,599015,10,599021,10,599023,10,599029,10,599031,10,599037,10,599039,10,599232,13,599233,13,599234,13,599235,13,599236,13,599237,13,599238,13,599239,13,599240,12,599241,12,599250,11,599254,11,599256,12,599257,12,599258,11,599262,11,599269,10,599271,10,599272,12,599273,12,599277,10,599279,10,599282,11,599285,10,599286,11,599287,10,599288,12,599289,12,599290,11,599293,10,599294,11,599295,10],e.p2D=[0,0,1,-1,0,0,-1,1,0,2,1,1,1,2,2,0,1,2,0,2,1,0,0,0],e.p3D=[0,0,1,-1,0,0,1,0,-1,0,0,-1,1,0,0,0,1,-1,0,0,-1,0,1,0,0,-1,1,0,2,1,1,0,1,1,1,-1,0,2,1,0,1,1,1,-1,1,0,2,0,1,1,1,-1,1,1,1,3,2,1,0,3,1,2,0,1,3,2,0,1,3,1,0,2,1,3,0,2,1,3,0,1,2,1,1,1,0,0,2,2,0,0,1,1,0,1,0,2,0,2,0,1,1,0,0,1,2,0,0,2,2,0,0,0,0,1,1,-1,1,2,0,0,0,0,1,-1,1,1,2,0,0,0,0,1,1,1,-1,2,3,1,1,1,2,0,0,2,2,3,1,1,1,2,2,0,0,2,3,1,1,1,2,0,2,0,2,1,1,-1,1,2,0,0,2,2,1,1,-1,1,2,2,0,0,2,1,-1,1,1,2,0,0,2,2,1,-1,1,1,2,0,2,0,2,1,1,1,-1,2,2,0,0,2,1,1,1,-1,2,0,2,0],e.p4D=[0,0,1,-1,0,0,0,1,0,-1,0,0,1,0,0,-1,0,0,-1,1,0,0,0,0,1,-1,0,0,0,1,0,-1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,-1,0,0,-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,2,1,1,0,0,1,1,1,-1,0,1,1,1,0,-1,0,2,1,0,1,0,1,1,-1,1,0,1,1,0,1,-1,0,2,0,1,1,0,1,-1,1,1,0,1,0,1,1,-1,0,2,1,0,0,1,1,1,-1,0,1,1,1,0,-1,1,0,2,0,1,0,1,1,-1,1,0,1,1,0,1,-1,1,0,2,0,0,1,1,1,-1,0,1,1,1,0,-1,1,1,1,4,2,1,1,0,4,1,2,1,0,4,1,1,2,0,1,4,2,1,0,1,4,1,2,0,1,4,1,1,0,2,1,4,2,0,1,1,4,1,0,2,1,4,1,0,1,2,1,4,0,2,1,1,4,0,1,2,1,4,0,1,1,2,1,2,1,1,0,0,3,2,1,0,0,3,1,2,0,0,1,2,1,0,1,0,3,2,0,1,0,3,1,0,2,0,1,2,0,1,1,0,3,0,2,1,0,3,0,1,2,0,1,2,1,0,0,1,3,2,0,0,1,3,1,0,0,2,1,2,0,1,0,1,3,0,2,0,1,3,0,1,0,2,1,2,0,0,1,1,3,0,0,2,1,3,0,0,1,2,2,3,1,1,1,0,2,1,1,1,-1,2,2,0,0,0,2,3,1,1,0,1,2,1,1,-1,1,2,2,0,0,0,2,3,1,0,1,1,2,1,-1,1,1,2,2,0,0,0,2,3,1,1,1,0,2,1,1,1,-1,2,0,2,0,0,2,3,1,1,0,1,2,1,1,-1,1,2,0,2,0,0,2,3,0,1,1,1,2,-1,1,1,1,2,0,2,0,0,2,3,1,1,1,0,2,1,1,1,-1,2,0,0,2,0,2,3,1,0,1,1,2,1,-1,1,1,2,0,0,2,0,2,3,0,1,1,1,2,-1,1,1,1,2,0,0,2,0,2,3,1,1,0,1,2,1,1,-1,1,2,0,0,0,2,2,3,1,0,1,1,2,1,-1,1,1,2,0,0,0,2,2,3,0,1,1,1,2,-1,1,1,1,2,0,0,0,2,2,1,1,1,-1,0,1,1,1,0,-1,0,0,0,0,0,2,1,1,-1,1,0,1,1,0,1,-1,0,0,0,0,0,2,1,-1,1,1,0,1,0,1,1,-1,0,0,0,0,0,2,1,1,-1,0,1,1,1,0,-1,1,0,0,0,0,0,2,1,-1,1,0,1,1,0,1,-1,1,0,0,0,0,0,2,1,-1,0,1,1,1,0,-1,1,1,0,0,0,0,0,2,1,1,1,-1,0,1,1,1,0,-1,2,2,0,0,0,2,1,1,-1,1,0,1,1,0,1,-1,2,2,0,0,0,2,1,1,-1,0,1,1,1,0,-1,1,2,2,0,0,0,2,1,1,1,-1,0,1,1,1,0,-1,2,0,2,0,0,2,1,-1,1,1,0,1,0,1,1,-1,2,0,2,0,0,2,1,-1,1,0,1,1,0,1,-1,1,2,0,2,0,0,2,1,1,-1,1,0,1,1,0,1,-1,2,0,0,2,0,2,1,-1,1,1,0,1,0,1,1,-1,2,0,0,2,0,2,1,-1,0,1,1,1,0,-1,1,1,2,0,0,2,0,2,1,1,-1,0,1,1,1,0,-1,1,2,0,0,0,2,2,1,-1,1,0,1,1,0,1,-1,1,2,0,0,0,2,2,1,-1,0,1,1,1,0,-1,1,1,2,0,0,0,2,3,1,1,0,0,0,2,2,0,0,0,2,1,1,1,-1,3,1,0,1,0,0,2,0,2,0,0,2,1,1,1,-1,3,1,0,0,1,0,2,0,0,2,0,2,1,1,1,-1,3,1,1,0,0,0,2,2,0,0,0,2,1,1,-1,1,3,1,0,1,0,0,2,0,2,0,0,2,1,1,-1,1,3,1,0,0,0,1,2,0,0,0,2,2,1,1,-1,1,3,1,1,0,0,0,2,2,0,0,0,2,1,-1,1,1,3,1,0,0,1,0,2,0,0,2,0,2,1,-1,1,1,3,1,0,0,0,1,2,0,0,0,2,2,1,-1,1,1,3,1,0,1,0,0,2,0,2,0,0,2,-1,1,1,1,3,1,0,0,1,0,2,0,0,2,0,2,-1,1,1,1,3,1,0,0,0,1,2,0,0,0,2,2,-1,1,1,1,3,3,2,1,0,0,3,1,2,0,0,4,1,1,1,1,3,3,2,0,1,0,3,1,0,2,0,4,1,1,1,1,3,3,0,2,1,0,3,0,1,2,0,4,1,1,1,1,3,3,2,0,0,1,3,1,0,0,2,4,1,1,1,1,3,3,0,2,0,1,3,0,1,0,2,4,1,1,1,1,3,3,0,0,2,1,3,0,0,1,2,4,1,1,1,1,3,3,2,1,0,0,3,1,2,0,0,2,1,1,1,-1,3,3,2,0,1,0,3,1,0,2,0,2,1,1,1,-1,3,3,0,2,1,0,3,0,1,2,0,2,1,1,1,-1,3,3,2,1,0,0,3,1,2,0,0,2,1,1,-1,1,3,3,2,0,0,1,3,1,0,0,2,2,1,1,-1,1,3,3,0,2,0,1,3,0,1,0,2,2,1,1,-1,1,3,3,2,0,1,0,3,1,0,2,0,2,1,-1,1,1,3,3,2,0,0,1,3,1,0,0,2,2,1,-1,1,1,3,3,0,0,2,1,3,0,0,1,2,2,1,-1,1,1,3,3,0,2,1,0,3,0,1,2,0,2,-1,1,1,1,3,3,0,2,0,1,3,0,1,0,2,2,-1,1,1,1,3,3,0,0,2,1,3,0,0,1,2,2,-1,1,1,1]},function(t,e,i){"use strict";i.r(e);class s{constructor(t,e){this.changed=!1,this.elm=document.createElement("div"),this.elm.classList.add("ConfigEditor"),this.config=e,this.inputValids=[],this.restoreButtonEnabled=!0,this.submitButton=document.createElement("button"),this.submitButton.classList.add("submit"),this.submitButton.innerHTML="Start the simulation!",this.submitButton.addEventListener("click",()=>{this.allInputsAreValid()?this.submitHandler&&this.submitHandler(this.config):this.invalidSubmitionHandler&&this.invalidSubmitionHandler()}),this.restoreButton=document.createElement("button"),this.restoreButton.classList.add("restore"),this.restoreButton.innerHTML="Restore config",this.restoreButton.addEventListener("click",()=>{this.restoreButtonEnabled&&(this.restoreConfig(this.config,JSON.parse(localStorage[s.localStorageKey]),this.inputTree),this.restoreButton.classList.add("disabled"))}),localStorage[s.localStorageKey]||(this.restoreButtonEnabled=!1,this.restoreButton.classList.add("disabled")),this.inputTree={},this.elm.appendChild(this.createConfigTree(t,this.config,this.inputTree)),this.elm.appendChild(this.submitButton),this.elm.appendChild(this.restoreButton)}appendTo(t){t.appendChild(this.elm),this.parent=t}saveConfigToLocalStorage(){localStorage[s.localStorageKey]=JSON.stringify(this.config)}remove(){if(!this.parent)throw new Error("Was never appended");this.parent.removeChild(this.elm)}setSubmitHandler(t){this.submitHandler=t}setInvalidSubmitionHandler(t){this.invalidSubmitionHandler=t}restoreConfig(t,e,i){const s=Object.keys(t);for(const n of s)typeof t[n]==typeof e[n]&&("object"!=typeof e[n]?(t[n]=e[n],"boolean"==typeof t[n]?i[n].checked=e[n]:i[n].value=e[n]):this.restoreConfig(t[n],e[n],i[n]))}allInputsAreValid(){for(const t of this.inputValids)if(!t)return!1;return!0}createConfigTree(t,e,i,s=1){const n=document.createElement("div"),a=document.createElement("h"+s),h=Object.keys(e);n.classList.add("section"),a.classList.add("heading"),a.innerHTML=t,n.appendChild(a);for(const t of h){const a=e[t];switch(typeof a){case"number":{const{elm:s,input:h}=this.createNumberInput(e,t,a);n.appendChild(s),i[t]=h;break}case"string":{const{elm:s,input:h}=this.createStringInput(e,t,a);n.appendChild(s),i[t]=h;break}case"boolean":{const{elm:s,input:h}=this.createBooleanInput(e,t,a);n.appendChild(s),i[t]=h;break}case"object":{const e={};i[t]=e,n.appendChild(this.createConfigTree(this.formatCamelCase(t),a,e,s+1));break}}}return n}createNumberInput(t,e,i){return this.createInput("number",t,i.toString(),e,t=>{const e=parseInt(t);if(!isNaN(e))return e})}createStringInput(t,e,i){return this.createInput("text",t,i,e,t=>t||void 0)}createBooleanInput(t,e,i){const s=document.createElement("div"),n=document.createElement("label"),a=document.createElement("input");s.classList.add("configItem"),a.type="checkbox",a.checked=i,n.innerText=this.formatCamelCase(e),s.appendChild(a),s.appendChild(n);const h=()=>{this.changed=!0,t[e]=a.checked};return n.addEventListener("click",()=>{a.checked=!a.checked,h()}),a.addEventListener("change",h),{elm:s,input:a}}createInput(t,e,i,s,n){const a=document.createElement("div"),h=document.createElement("label"),r=document.createElement("input"),o=this.inputValids.push(!0);return a.classList.add("configItem"),r.type=t,r.value=i,h.innerText=this.formatCamelCase(s),a.appendChild(h),a.appendChild(r),r.addEventListener("change",()=>{a.classList.remove("invalid"),this.inputValids[o]=!0,this.changed=!0;const t=n(r.value);void 0===t?(a.classList.add("invalid"),this.inputValids[o]=!1):e[s]=t}),{elm:a,input:r}}formatCamelCase(t){const e=t.split(/(?=[a-zA-Z])(?=[A-Z])/g),i=e.length;{const t=e[0];e[0]=t[0].toUpperCase()+t.slice(1)}for(let t=1;t<i;t++){const i=e[t];e[t]=i[0].toLowerCase()+i.slice(1)}return e.join(" ")}}s.localStorageKey="diepGES-config";var n=s;class a{constructor(){this.totalXP=0,this.level=1,this.levelUpHandlers=[]}addXP(t){for(this.totalXP+=t;this.totalXP>=a.requiredForLevel[this.level+1];)this.level++,this.dispatchLevelUp()}reset(){this.level=1,this.totalXP=0}onLevelUp(t){this.levelUpHandlers.push(t)}dispatchLevelUp(){for(const t of this.levelUpHandlers)t()}}a.maxLevel=35,a.requiredForLevel=[];for(let t=0;t<=a.maxLevel;t++)a.requiredForLevel[t]=.5*t**(.07*t)+1.3*t**2.8-1.8;a.requiredForLastLevel=a.requiredForLevel[a.maxLevel];var h=a;var r=class{constructor(){this.initalTanks=192,this.maintainTanks=64,this.targetEntities=6400,this.size=24e3,this.spawnRates={square:5,triangle:3,pentagon:2},this.player={beInTheGame:!1,level:h.maxLevel,build:{healthRegeneration:36,maxHealth:36,bodyDamage:36,bulletSpeed:7,bulletPenetration:36,bulletDamage:36,reload:10,movementSpeed:36}},this.debug={drawHitCircles:!1,drawQuadTree:!1}}};var o=class{constructor(t,e){this.debugDrawHitCircle=!1,this.canvas=t,this.camera=e,this.X=t.getX()}renderEntitiesInTree(t){const e=performance.now(),i=this.canvas.width/this.camera.scale,s=this.canvas.height/this.camera.scale,n=-this.camera.x/this.camera.scale,a=-this.camera.y/this.camera.scale,h=t.rectQueryNoVerify(n,a,i,s);if(this.X.fillStyle="#c9c9c9",this.X.fillRect(0,0,this.canvas.width,this.canvas.height),this.camera.apply(this.X),this.X.fillStyle="#00000008",this.drawGrid(n,a,i,s),this.debugDrawHitCircle)for(const t of h)this.X.save(),t.render(this.X,e),this.X.restore(),t.__debugRenderHitCircle(this.X);else for(const t of h)this.X.save(),t.render(this.X,e),this.X.restore();this.X.resetTransform()}debugRenderQuadtree(t){this.camera.apply(this.X),t.debugRender(this.X),this.X.resetTransform()}drawGrid(t,e,i,s){if(this.camera.scale<.1)return;const n=t+i,a=e+s;this.X.strokeStyle="#000000",this.X.globalAlpha=.1,this.X.lineWidth=.5,this.X.beginPath();for(let i=25*Math.floor(t/25);i<n;i+=25)this.X.moveTo(i,e),this.X.lineTo(i,a);for(let i=25*Math.floor(e/25);i<a;i+=25)this.X.moveTo(t,i),this.X.lineTo(n,i);this.X.stroke(),this.X.globalAlpha=1}};class l{constructor(){this.then=performance.now(),this.leftOverFixed=0}resume(){this.then=performance.now()}tickAll(t){const e=performance.now(),i=e-this.then;this.then=e;for(const e of t)e.tick(i);for(this.leftOverFixed+=i;this.leftOverFixed>=l.fixedTime;this.leftOverFixed-=l.fixedTime)for(const e of t)e._sleeping||e.fixedTick()}}l.fixedTime=1e3/120;var d=l;function c(t,e){return{x:t||0,y:e||0}}class u{constructor(){this.handlers=[]}add(t){this.handlers.push(t)}remove(t){const e=this.handlers.indexOf(t);if(e<0)throw new Error("Removing handler that doesn't exist");this.handlers.splice(e,1)}dispatch(t){for(const e of this.handlers)e(t)}hasAny(){return this.handlers.length>0}}function m(t,e){return Math.sqrt(t*t+e*e)}var p=class{constructor(t){this.elm=t,this.touchMap=new Map,this.singleTapped=!1,this.singleTapPos=c(),this.touchMoved=!1,this.moveHandlers=new u,this.startMoveHandlers=new u,this.endMoveHandlers=new u,this.zoomHandlers=new u,this.tapHandlers=new u,this.doubleTapHandlers=new u}setup(){this.addEventHandlers()}destory(){this.removeEventHandlers()}onMove(t){this.moveHandlers.add(t)}onStartMove(t){this.startMoveHandlers.add(t)}onEndMove(t){this.endMoveHandlers.add(t)}onZoom(t){this.zoomHandlers.add(t)}onDoubleTap(t){this.doubleTapHandlers.add(t)}onTap(t){this.tapHandlers.add(t)}addEventHandlers(){this.touchStartHandler=this.touchStartHandler.bind(this),this.elm.addEventListener("touchstart",this.touchStartHandler),this.touchEndHandler=this.touchEndHandler.bind(this),this.elm.addEventListener("touchend",this.touchEndHandler.bind(this)),this.touchMoveHandler=this.touchMoveHandler.bind(this),this.elm.addEventListener("touchmove",this.touchMoveHandler.bind(this))}removeEventHandlers(){this.elm.removeEventListener("touchstart",this.touchStartHandler),this.elm.removeEventListener("touchend",this.touchEndHandler),this.elm.removeEventListener("touchmove",this.touchMoveHandler)}touchStartHandler(t){t.cancelable&&t.preventDefault(),0===this.touchMap.size&&(this.startMoveHandlers.dispatch(),this.touchMoved=!1);for(let e=0;e<t.changedTouches.length;e++){const i=t.changedTouches[e];this.touchMap.set(i.identifier,c(i.clientX,i.clientY))}}touchEndHandler(t){t.cancelable&&t.preventDefault();for(let e=0;e<t.changedTouches.length;e++){const i=t.changedTouches[e];this.touchMap.delete(i.identifier)}if(this.prevCenterX=void 0,this.prevCenterY=void 0,0===this.touchMap.size&&(this.endMoveHandlers.dispatch(),!this.touchMoved)){const e=t.changedTouches[0],i=c(e.clientX,e.clientY);this.singleTapped?(m(this.singleTapPos.x-e.clientX,this.singleTapPos.y-e.clientY)<64&&this.doubleTapHandlers.dispatch(i),this.singleTapped=!1):(this.singleTapPos=i,this.singleTapped=!0),this.tapHandlers.dispatch(i)}}touchMoveHandler(t){t.cancelable&&t.preventDefault();let e=!1;t.touches.length>=2&&(this.checkZoom(t.touches[0],t.touches[1]),e=!0);for(let i=0;i<t.changedTouches.length;i++){const s=t.changedTouches[i],n=this.touchMap.get(s.identifier);e||this.moveHandlers.dispatch(c(s.clientX-n.x,s.clientY-n.y)),this.touchMap.set(s.identifier,c(s.clientX,s.clientY))}this.touchMoved=!0}checkZoom(t,e){const i=this.touchMap.get(t.identifier),s=this.touchMap.get(e.identifier),n=m(t.clientX-e.clientX,t.clientY-e.clientY),a=m(i.x-s.x,i.y-s.y),h=(t.clientX+e.clientX)/2,r=(t.clientY+e.clientY)/2;if(this.zoomHandlers.dispatch([n/a,c(h,r)]),this.prevCenterX&&this.prevCenterY){const t=h-this.prevCenterX,e=r-this.prevCenterY;this.moveHandlers.dispatch(c(t,e))}this.prevCenterX=h,this.prevCenterY=r}};var f=class{constructor(){this.canvas=document.createElement("canvas"),this.X=this.canvas.getContext("2d"),this.canvas.width=this.width=1280,this.canvas.height=this.height=720,this.touchControls=new p(this.canvas),this.setup()}getX(){return this.X}appendTo(t){t.appendChild(this.canvas)}setup(){this.touchControls.setup(),addEventListener("resize",this.resizeHandler.bind(this)),this.resizeHandler()}resizeHandler(){this.width=this.canvas.width=innerWidth,this.height=this.canvas.height=innerHeight}};class g{constructor(t){this.elements=[],this.elementCount=0,this.children=null,this.halfSize=t/2}addAll(t){for(const e of t)this.add(e)}add(t){const e=t.x,i=t.y,s=t.radius;t._quadTreeX=e,t._quadTreeY=i;let n,a=this,h=this.halfSize,r=this.halfSize,o=this.halfSize/2;for(;;){if(n=o/2,a.elementCount++,null===a.children){a.elements.push(t),a.elementCount>g.leafMax&&this.growLeaf(a,h,r);break}if(i>r)if(e>h){if(!(e-s>=h&&i-s>=r)){a.elements.push(t);break}a=a.children[0],h+=o,r+=o,o=n}else{if(!(e+s<=h&&i-s>=r)){a.elements.push(t);break}a=a.children[1],h-=o,r+=o,o=n}else if(e>h){if(!(e-s>=h&&i+s<=r)){a.elements.push(t);break}a=a.children[3],h+=o,r-=o,o=n}else{if(!(e+s<=h&&i+s<=r)){a.elements.push(t);break}a=a.children[2],h-=o,r-=o,o=n}}}updateSingle(t){const e=t._quadTreeX,i=t._quadTreeY,s=t.x,n=t.y,a=t.radius;t._quadTreeX=s,t._quadTreeY=n;const h=[];let r,o,l,d=!1,c=this,u=this.halfSize,m=this.halfSize,p=this.halfSize/2;t:for(;;){o=p/2;const s=c.elements.indexOf(t);if(s>=0){c.elements.splice(s,1),d=!0;break t}if(h.push([c,u,m,p]),null===c.children)break;i>m?e>u?(c=c.children[0],u+=p,m+=p,p=o):(c=c.children[1],u-=p,m+=p,p=o):e>u?(c=c.children[3],u+=p,m-=p,p=o):(c=c.children[2],u-=p,m-=p,p=o)}if(!d)throw new Error("Could not find obj to update");for(c.elementCount--;;){const t=2*p;if(u-t<s-a&&u+t>s+a&&m-t<n-a&&m+t>n+a)break;if(!r&&c.elementCount<g.branchMin&&(r=c),!(l=h.pop()))break;c=l[0],u=l[1],m=l[2],p=l[3],c.elementCount--}for(;;){if(o=p/2,c.elementCount++,null===c.children){c.elements.push(t),c.elementCount>g.leafMax&&this.growLeaf(c,u,m);break}if(n>m)if(s>u){if(!(s-a>=u&&n-a>=m)){c.elements.push(t);break}c=c.children[0],u+=p,m+=p,p=o}else{if(!(s+a<=u&&n-a>=m)){c.elements.push(t);break}c=c.children[1],u-=p,m+=p,p=o}else if(s>u){if(!(s-a>=u&&n+a<=m)){c.elements.push(t);break}c=c.children[3],u+=p,m-=p,p=o}else{if(!(s+a<=u&&n+a<=m)){c.elements.push(t);break}c=c.children[2],u-=p,m-=p,p=o}}r&&this.mergeBranch(r)}remove(t){const e=t._quadTreeX,i=t._quadTreeY;let s,n,a=this,h=this.halfSize,r=this.halfSize,o=this.halfSize/2;for(;;){a.elementCount--,n=o/2;const l=a.elements.indexOf(t);if(l>=0)return a.elements.splice(l,1),void(s&&this.mergeBranch(s));if(null===a.children)throw new Error("Could not find obj for removal");!s&&a.elementCount<g.branchMin&&(s=a),i>r?e>h?(a=a.children[0],h+=o,r+=o,o=n):(a=a.children[1],h-=o,r+=o,o=n):e>h?(a=a.children[3],h+=o,r-=o,o=n):(a=a.children[2],h-=o,r-=o,o=n)}}queryOne(t,e,i,s){const n=[[this,this.halfSize,this.halfSize,this.halfSize/2]];let a;for(;a=n.pop();){const h=a[0];if(null!==h.children){const s=a[1],r=a[2],o=a[3],l=o/2;e>r?t>s?(n.push([h.children[0],s+o,r+o,l]),t-i<s?(n.push([h.children[1],s-o,r+o,l]),e-i<r&&(n.push([h.children[2],s-o,r-o,l]),n.push([h.children[3],s+o,r-o,l]))):e-i<r&&n.push([h.children[3],s+o,r-o,l])):(n.push([h.children[1],s-o,r+o,l]),t+i>s?(n.push([h.children[0],s+o,r+o,l]),e-i<r&&(n.push([h.children[2],s-o,r-o,l]),n.push([h.children[3],s+o,r-o,l]))):e-i<r&&n.push([h.children[2],s-o,r-o,l])):t>s?(n.push([h.children[3],s+o,r-o,l]),t-i<s?(n.push([h.children[2],s-o,r-o,l]),e+i>r&&(n.push([h.children[0],s+o,r+o,l]),n.push([h.children[1],s-o,r+o,l]))):e+i>r&&n.push([h.children[0],s+o,r+o,l])):(n.push([h.children[2],s-o,r-o,l]),t+i>s?(n.push([h.children[3],s+o,r-o,l]),e+i>r&&(n.push([h.children[0],s+o,r+o,l]),n.push([h.children[1],s-o,r+o,l]))):e+i>r&&n.push([h.children[1],s-o,r+o,l]))}for(let n=h.elements.length-1;n>=0;n--){if(h.elements[n]===s)continue;const a=h.elements[n],r=a.x-t,o=a.y-e,l=a.radius+i;if(r*r+o*o<l*l)return a}}}query(t,e,i){const s=[[this,this.halfSize,this.halfSize,this.halfSize/2]],n=[];let a;for(;a=s.pop();){const h=a[0];if(null!==h.children){const n=a[1],r=a[2],o=a[3],l=o/2;e>r?t>n?(s.push([h.children[0],n+o,r+o,l]),t-i<n?(s.push([h.children[1],n-o,r+o,l]),e-i<r&&(s.push([h.children[2],n-o,r-o,l]),s.push([h.children[3],n+o,r-o,l]))):e-i<r&&s.push([h.children[3],n+o,r-o,l])):(s.push([h.children[1],n-o,r+o,l]),t+i>n?(s.push([h.children[0],n+o,r+o,l]),e-i<r&&(s.push([h.children[2],n-o,r-o,l]),s.push([h.children[3],n+o,r-o,l]))):e-i<r&&s.push([h.children[2],n-o,r-o,l])):t>n?(s.push([h.children[3],n+o,r-o,l]),t-i<n?(s.push([h.children[2],n-o,r-o,l]),e+i>r&&(s.push([h.children[0],n+o,r+o,l]),s.push([h.children[1],n-o,r+o,l]))):e+i>r&&s.push([h.children[0],n+o,r+o,l])):(s.push([h.children[2],n-o,r-o,l]),t+i>n?(s.push([h.children[3],n+o,r-o,l]),e+i>r&&(s.push([h.children[0],n+o,r+o,l]),s.push([h.children[1],n-o,r+o,l]))):e+i>r&&s.push([h.children[1],n-o,r+o,l]))}for(let s=h.elements.length-1;s>=0;s--){const a=h.elements[s],r=a.x-t,o=a.y-e,l=a.radius+i;r*r+o*o<l*l&&n.push(a)}}return n}rectQueryNoVerify(t,e,i,s){const n=t+i/2,a=e+s/2,h=i/2,r=s/2,o=[],l=[[this,this.halfSize,this.halfSize,this.halfSize/2]];let d;for(;d=l.pop();){const t=d[0];if(null!==t.children){const e=d[1],i=d[2],s=d[3],o=s/2;a>i?n>e?(l.push([t.children[0],e+s,i+s,o]),n-h<e?(l.push([t.children[1],e-s,i+s,o]),a-r<i&&(l.push([t.children[2],e-s,i-s,o]),l.push([t.children[3],e+s,i-s,o]))):a-r<i&&l.push([t.children[3],e+s,i-s,o])):(l.push([t.children[1],e-s,i+s,o]),n+h>e?(l.push([t.children[0],e+s,i+s,o]),a-r<i&&(l.push([t.children[2],e-s,i-s,o]),l.push([t.children[3],e+s,i-s,o]))):a-r<i&&l.push([t.children[2],e-s,i-s,o])):n>e?(l.push([t.children[3],e+s,i-s,o]),n-h<e?(l.push([t.children[2],e-s,i-s,o]),a+r>i&&(l.push([t.children[0],e+s,i+s,o]),l.push([t.children[1],e-s,i+s,o]))):a+r>i&&l.push([t.children[0],e+s,i+s,o])):(l.push([t.children[2],e-s,i-s,o]),n+h>e?(l.push([t.children[3],e+s,i-s,o]),a+r>i&&(l.push([t.children[0],e+s,i+s,o]),l.push([t.children[1],e-s,i+s,o]))):a+r>i&&l.push([t.children[1],e-s,i+s,o]))}for(let e=t.elements.length-1;e>=0;e--){const i=t.elements[e];o.push(i)}}return o}debugRender(t){t.save(),t.strokeStyle="#ff8888",t.font="bold 16px Arial",t.textAlign="center",t.textBaseline="middle",t.lineWidth=1;const e=[[this,this.halfSize,this.halfSize,this.halfSize/2]];let i;for(;i=e.pop();){const s=i[0],n=i[1],a=i[2],h=i[3],r=h/2,o=2*h;null!==s.children&&(e.push([s.children[0],n+h,a+h,r]),e.push([s.children[1],n-h,a+h,r]),e.push([s.children[2],n-h,a-h,r]),e.push([s.children[3],n+h,a-h,r])),t.fillStyle="#dd5555",t.fillText(s.elementCount.toString(),n,a),t.beginPath(),t.fillStyle="#ff000008",t.rect(n-o,a-o,2*o,2*o),t.stroke(),t.fill()}t.restore()}growLeaf(t,e,i){t.children=[{elements:[],children:null,elementCount:0},{elements:[],children:null,elementCount:0},{elements:[],children:null,elementCount:0},{elements:[],children:null,elementCount:0}];const s=t.elements;t.elements=[];for(let n=s.length-1;n>=0;n--){const a=s[n],h=a._quadTreeX,r=a._quadTreeY,o=a.radius;r>i?h>e?h-o>=e&&r-o>=i?(t.children[0].elements.push(a),t.children[0].elementCount++):t.elements.push(a):h+o<=e&&r-o>=i?(t.children[1].elements.push(a),t.children[1].elementCount++):t.elements.push(a):h>e?h-o>=e&&r+o<=i?(t.children[3].elements.push(a),t.children[3].elementCount++):t.elements.push(a):h+o<=e&&r+o<=i?(t.children[2].elements.push(a),t.children[2].elementCount++):t.elements.push(a)}}mergeBranch(t){const e=[],i=[t];let s;for(;s=i.pop();){null!==s.children&&s.elementCount>0&&(i.push(s.children[0]),i.push(s.children[1]),i.push(s.children[2]),i.push(s.children[3]));for(let t=s.elements.length-1;t>=0;t--)e.push(s.elements[t])}t.elements=e,t.children=null}}g.leafMax=6,g.branchMin=6,g.maxDepth=8;var v=g;var y=class{collideAll(t){for(const e of t)e._collisionObj=void 0,e._sleeping||this.quadTree.updateSingle(e);for(let e=0;e<t.length;e++){const i=t[e];if(i._sleeping)continue;const s=this.quadTree.queryOne(i.x,i.y,i.radius,i);s&&s._collisionObj!==i&&(i.collideWith(s),i._collisionObj=s)}}setBoundaries(t){this.quadTree=new v(Math.max(t.width,t.height))}getQuadTree(){return this.quadTree}newEntity(t){this.quadTree.add(t)}removeEntity(t){this.quadTree.remove(t)}};var b=class{setBoundaries(t){this.boundaries=t}boundAll(t){if(this.boundaries)for(const e of t)e._sleeping||(e.x<e.radius?(e.x=e.radius,e.vx=Math.abs(e.vx)):e.x>this.boundaries.width-e.radius&&(e.x=this.boundaries.width-e.radius,e.vx=-Math.abs(e.vx)),e.y<e.radius?(e.y=e.radius,e.vy=Math.abs(e.vy)):e.y>this.boundaries.height-e.radius&&(e.y=this.boundaries.height-e.radius,e.vy=-Math.abs(e.vy)))}};var x=class{constructor(t){this.collider=t}removeAllIfDestoryed(t){for(let e=t.length-1;e>=0;e--)t[e].destoryed&&(this.collider.removeEntity(t[e]),t.splice(e,1))}};const M=new class{constructor(){this.down=40,this.right=39,this.up=38,this.left=37,this.a=65,this.b=66,this.c=67,this.d=68,this.e=69,this.f=70,this.g=71,this.h=72,this.i=73,this.j=74,this.k=75,this.l=76,this.m=77,this.n=78,this.o=79,this.p=80,this.q=81,this.r=82,this.s=83,this.t=84,this.u=85,this.v=86,this.w=87,this.x=88,this.y=89,this.z=90,this.space=32,this.esc=27}};const T=new class{constructor(){this.map=[],this.fillMap(),this.addEventHandlers()}isDown(t){return this.map[M[t]]}fillMap(){for(let t=0;t<256;t++)this.map[t]=!1}addEventHandlers(){addEventListener("keydown",this.keydownHandler.bind(this)),addEventListener("keyup",this.keyupHandler.bind(this)),addEventListener("blur",this.blurHandler.bind(this))}keydownHandler(t){this.map[t.keyCode]=!0}keyupHandler(t){this.map[t.keyCode]=!1}blurHandler(){for(let t=0;t<this.map.length;t++)this.map[t]=!1}};const w=new class{constructor(){this.clientX=this.x=innerWidth/2,this.clientY=this.y=innerHeight/2,this.down=!1,this.setup()}attachCamera(t){this.camera=t,this.camera.onUpdateLocation(this.updateCameraPos.bind(this))}setup(){addEventListener("mousemove",this.mousemoveHandler.bind(this)),addEventListener("mousedown",this.mousedownHandler.bind(this)),addEventListener("mouseup",this.mouseupHandler.bind(this)),addEventListener("touchstart",this.touchstartHandler.bind(this)),addEventListener("touchend",this.touchendHandler.bind(this)),addEventListener("touchmove",this.touchmoveHandler.bind(this))}mousemoveHandler(t){this.updateCameraPos({x:t.clientX,y:t.clientY})}mousedownHandler(t){0===t.button&&(this.updateCameraPos({x:t.clientX,y:t.clientY}),this.down=!0)}mouseupHandler(t){this.updateCameraPos({x:t.clientX,y:t.clientY}),this.down=!1}touchstartHandler(t){this.updateCameraPos({x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY}),this.down=!0}touchendHandler(t){this.updateCameraPos({x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY}),this.down=!1}touchmoveHandler(t){this.updateCameraPos({x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY})}updateCameraPos(t){this.camera?t?(this.x=(t.x-this.camera.x)/this.camera.scale,this.y=(t.y-this.camera.y)/this.camera.scale,this.clientX=t.x,this.clientY=t.y):(this.x=(this.clientX-this.camera.x)/this.camera.scale,this.y=(this.clientY-this.camera.y)/this.camera.scale):t&&(this.x=t.y,this.y=t.x)}};var D=class{constructor(t){this.tx=this.x=0,this.ty=this.y=0,this.tScale=this.scale=1,this.attached=!1,this.canvas=t,this.attachedFromX=0,this.attachedFromY=0,this.cursorLocked=!1,this.updateLocationHandlers=[],this.setup()}apply(t){t.translate(this.x,this.y),t.scale(this.scale,this.scale)}applyTranslateOnly(t){t.translate(this.x,this.y)}goto(t,e,i){i&&(this.tScale=i),this.tx=-t*this.tScale+this.canvas.width/2,this.ty=-e*this.tScale+this.canvas.height/2}gotoNoTransition(t,e,i){i&&(this.scale=this.tScale=i),this.x=this.tx=-t*this.tScale+this.canvas.width/2,this.y=this.ty=-e*this.tScale+this.canvas.height/2}attachTo(t){if(t)this.attachedFromX=this.x,this.attachedFromY=this.y,this.attached=!0;else{if(this.attachee){const t=Math.atan2(this.y-this.attachedFromY,this.x-this.attachedFromX);this.tx-=100*Math.cos(t),this.ty-=100*Math.sin(t)}this.attached=!1}this.attachee=t}setup(){addEventListener("mousemove",t=>{this.attached||(T.isDown("space")||w.down)&&this.move(t.movementX,t.movementY)}),addEventListener("mouseout",()=>{T.isDown("space")&&(document.body.requestPointerLock(),this.cursorLocked=!0)}),addEventListener("keyup",()=>{!T.isDown("space")&&this.cursorLocked&&(document.exitPointerLock(),this.cursorLocked=!1)}),addEventListener("wheel",t=>{let e=1.2;t.deltaY>0&&(e=1/e),this.zoomInto(e,t.clientX,t.clientY)}),this.canvas.touchControls.onMove(t=>{this.move(t.x,t.y)}),this.canvas.touchControls.onZoom(t=>{const[e,i]=t;this.zoomInto(e,i.x,i.y)})}onUpdateLocation(t){this.updateLocationHandlers.push(t)}updateLocation(){this.updateTarget(),this.ease()}zoomInto(t,e,i){if(this.attached)this.goto(this.attachee.x,this.attachee.y);else{let s=e,n=i;this.cursorLocked&&(s=innerWidth/2,n=innerHeight/2);const a=-(s-this.tx)*(t-1),h=-(n-this.ty)*(t-1);this.tx+=a,this.ty+=h}this.tScale*=t}move(t,e){this.x+=t,this.y+=e,this.tx+=t,this.ty+=e}updateTarget(){if(this.attachee)if(this.attachee.destoryed)this.attachTo(void 0);else{this.goto(this.attachee.x,this.attachee.y);for(const t of this.updateLocationHandlers)t()}}ease(){this.scale+=(this.tScale-this.scale)/6,this.x+=(this.tx-this.x)/6,this.y+=(this.ty-this.y)/6}};const S=5e-4;var H=class{sleepAll(t){for(const e of t)e._sleeping=e._canSleep&&Math.abs(e.vx)+Math.abs(e.vy)<S}};var k=class{constructor(t){this.debugDrawHitCircles=!1,this.debugRenderQuadTree=!1,this.paused=!1,this.canvas=new f,this.camera=new D(this.canvas),this.renderer=new o(this.canvas,this.camera),this.collider=new y,this.ticker=new d,this.remover=new x(this.collider),this.bounder=new b,this.sleeper=new H,this.entities=t,this.renderHooks=[],w.attachCamera(this.camera)}pause(){this.paused=!0}resume(){this.paused&&(this.paused=!1,this.ticker.resume())}render(){if(this.paused)this.camera.updateLocation(),this.renderer.debugDrawHitCircle=this.debugDrawHitCircles,this.renderer.renderEntitiesInTree(this.collider.quadTree),this.debugRenderQuadTree&&this.renderer.debugRenderQuadtree(this.collider.quadTree);else{this.ticker.tickAll(this.entities),this.collider.collideAll(this.entities),this.bounder.boundAll(this.entities),this.remover.removeAllIfDestoryed(this.entities),this.camera.updateLocation(),this.renderer.debugDrawHitCircle=this.debugDrawHitCircles,this.renderer.renderEntitiesInTree(this.collider.quadTree),this.debugRenderQuadTree&&this.renderer.debugRenderQuadtree(this.collider.quadTree),this.sleeper.sleepAll(this.entities);for(const t of this.renderHooks)t()}}attachCameraTo(t){this.camera.attachTo(t)}setBoundaries(t){this.bounder.setBoundaries(t),this.collider.setBoundaries(t)}newEntity(t){this.collider.newEntity(t)}appendTo(t){this.canvas.appendTo(t)}getQuadTree(){return this.collider.getQuadTree()}onRender(t){this.renderHooks.push(t)}};class C{constructor(t){this._quadTreeX=0,this._quadTreeY=0,this._canSleep=!0,this._sleeping=!1,this.game=t,this.destoryed=!1,this.teamID=C.teamIDIncrementer++}collideWith(t){t.destoryed||this.damageHit(t)}setTeamID(t){this.teamID=t}destory(t){this.destoryed=!0}fixedTick(){this.x+=this.vx*d.fixedTime,this.y+=this.vy*d.fixedTime}__debugRenderHitCircle(t){t.strokeStyle="#ff0000",t.lineWidth=2,t.beginPath(),t.arc(this.x,this.y,this.radius,0,2*Math.PI),t.stroke()}damageHit(t){if(t.teamID===this.teamID)return;const e=t.health-this.damage*this.health,i=this.health-t.damage*t.health;t.health=e,this.health=i,e<=0&&t.destory(this),i<=0&&this.destory(t),this.reactHit(t),t.reactHit(this)}reactHit(t){}resetTeamId(){this.teamID=C.teamIDIncrementer++}}C.teamIDIncrementer=0;var I=C;function P(t,e){const i=Math.atan2(t.y-e.y,t.x-e.x),s=Math.cos(i),n=Math.sin(i),a=Math.cos(i+Math.PI/2),h=Math.sin(i+Math.PI/2),r=(t.x+e.x)/2,o=(t.y+e.y)/2,l=(t.radius+e.radius)/2,d=s*l,c=n*l;t.x=r+d,t.y=o+c,e.x=r-d,e.y=o-c;const u=Math.sqrt(t.vx*t.vx+t.vy*t.vy),m=Math.sqrt(e.vx*e.vx+e.vy*e.vy),p=Math.atan2(t.vy,t.vx),f=Math.atan2(e.vy,e.vx),g=Math.cos(f-i),v=Math.cos(p-i),y=(u*v*(t.radius-e.radius)+2*e.radius*m*g)/(t.radius+e.radius),b=u*Math.sin(p-i),x=(m*g*(e.radius-t.radius)+2*t.radius*u*v)/(t.radius+e.radius),M=m*Math.sin(f-i);t.vx=y*s+b*a,t.vy=y*n+b*h,e.vx=x*s+M*a,e.vy=x*n+M*h}function R(t){return t&&"function"==typeof t.giveXP}class E extends I{constructor(t,e,i){super(t),this.damage=1,this.teamID=E.polygonTeam,this.targetable=!0,this.x=e,this.y=i,this.vx=Math.random()-.5,this.vy=Math.random()-.5,this.vrotation=.0015*(Math.random()-.5),this.initalRotation=Math.random()*Math.PI*2,this.rotation=this.initalRotation}tick(){}fixedTick(){this.x+=this.vx*d.fixedTime,this.y+=this.vy*d.fixedTime,this.vx*=E.fixedFriction,this.vy*=E.fixedFriction}collideWith(t){super.collideWith(t),P(this,t)}destory(t){super.destory(t),R(t)&&t.giveXP(this.xpValue)}}E.fixedFriction=.995**d.fixedTime,E.polygonTeam=-1;var L=E;class X extends L{constructor(){super(...arguments),this.radius=17,this.health=2,this.xpValue=4}render(t,e){this.rotation=this.initalRotation+this.vrotation*e,t.translate(this.x,this.y),t.rotate(this.rotation),t.beginPath(),t.fillStyle="#fee468",t.strokeStyle="#baa84d",t.lineWidth=3,t.lineJoin="round",t.rect(-X.renderRadius,-X.renderRadius,2*X.renderRadius,2*X.renderRadius),t.fill(),t.stroke()}}X.renderRadius=14;var _=X;class A extends L{constructor(){super(...arguments),this.radius=15,this.health=6,this.xpValue=20}render(t,e){this.rotation=this.initalRotation+this.vrotation*e,t.translate(this.x,this.y),t.rotate(this.rotation),t.beginPath(),t.fillStyle="#f86e73",t.strokeStyle="#b65256",t.lineWidth=3,t.lineJoin="round",t.moveTo(A.points[0][0],A.points[0][1]),t.lineTo(A.points[1][0],A.points[1][1]),t.lineTo(A.points[2][0],A.points[2][1]),t.closePath(),t.fill(),t.stroke()}}A.renderedRadius=20,A.points=[[Math.cos(2*Math.PI/3)*A.renderedRadius,Math.sin(2*Math.PI/3)*A.renderedRadius],[Math.cos(4*Math.PI/3)*A.renderedRadius,Math.sin(4*Math.PI/3)*A.renderedRadius],[Math.cos(6*Math.PI/3)*A.renderedRadius,Math.sin(6*Math.PI/3)*A.renderedRadius]];var z=A;class q extends L{constructor(){super(...arguments),this.radius=28,this.health=10,this.xpValue=120}render(t,e){this.rotation=this.initalRotation+this.vrotation*e,t.translate(this.x,this.y),t.rotate(this.rotation),t.beginPath(),t.fillStyle="#7088f9",t.strokeStyle="#5364b7",t.lineWidth=3,t.lineJoin="round",t.moveTo(q.points[0][0],q.points[0][1]),t.lineTo(q.points[1][0],q.points[1][1]),t.lineTo(q.points[2][0],q.points[2][1]),t.lineTo(q.points[3][0],q.points[3][1]),t.lineTo(q.points[4][0],q.points[4][1]),t.closePath(),t.fill(),t.stroke()}}q.renderedRadius=32,q.points=[[Math.cos(2*Math.PI/5)*q.renderedRadius,Math.sin(2*Math.PI/5)*q.renderedRadius],[Math.cos(4*Math.PI/5)*q.renderedRadius,Math.sin(4*Math.PI/5)*q.renderedRadius],[Math.cos(6*Math.PI/5)*q.renderedRadius,Math.sin(6*Math.PI/5)*q.renderedRadius],[Math.cos(8*Math.PI/5)*q.renderedRadius,Math.sin(8*Math.PI/5)*q.renderedRadius],[Math.cos(10*Math.PI/5)*q.renderedRadius,Math.sin(10*Math.PI/5)*q.renderedRadius]];var B=q;var F=class{constructor(t,e){this.width=t,this.height=e}};class O extends I{constructor(t,e,i,s,n,a,h,r,o){super(t),this.ttl=1e4,this.targetable=!1,this.x=e,this.y=i,this.vx=Math.cos(n)*s,this.vy=Math.sin(n)*s,this.rotation=0,this.health=a,this.damage=h,this.radius=r,this.hue=o}render(t){t.beginPath(),t.lineWidth=3,t.strokeStyle="hsl("+this.hue+",79%,35%)",t.fillStyle="hsl("+this.hue+",78%,49%)",t.arc(this.x,this.y,this.radius,0,2*Math.PI),t.fill(),t.stroke()}tick(t){this.ttl-=t,this.ttl<0&&this.destory()}fixedTick(){this.x+=this.vx*d.fixedTime,this.y+=this.vy*d.fixedTime,this.vx*=O.fixedFriction,this.vy*=O.fixedFriction}collideWith(t){super.collideWith(t),P(this,t)}setFirer(t){this.teamID=t.teamID,this.firer=t}giveXP(t){this.firer&&this.firer.giveXP(t)}}O.fixedFriction=.99995**d.fixedTime;var W=O;class U{constructor(){this.healthRegeneration=0,this.maxHealth=0,this.bodyDamage=0,this.bulletSpeed=0,this.bulletPenetration=0,this.bulletDamage=0,this.reload=0,this.movementSpeed=0}static upgrade(t,e){return!(t[e]>=U.max)&&(t[e]++,!0)}static reset(t){const e=Object.keys(t);for(const i of e)t[i]=0}}U.max=7,U.keys=["healthRegeneration","maxHealth","bodyDamage","bulletSpeed","bulletPenetration","bulletDamage","reload","movementSpeed"];var Y=U;class Q{constructor(t=0,e=Q.baseWidth,i=.85,s=0,n=1,a=!0){this.angle=t,this.width=e,this.length=i,this.offset=s,this.cooldown=n,this.visible=a,this.warmth=0;const h=e/Q.baseWidth,r=h*h;this.bulletPower=r,this.cooldownTime=r*n,this.power=this.bulletPower/n,this.unstableness=Math.min(Math.max(1-i/Q.maxAccuracyLength,0),1)}clone(){return new Q(this.angle,this.width,this.length,this.offset,this.cooldown,this.visible)}cloneAndMutate(t){const e=.3*t;let i=this.angle,s=this.width,n=this.length,a=this.offset,h=this.cooldown;return i+=(Math.random()-.5)*Math.PI*.5*e,i%=2*Math.PI,Math.random()<e&&(s=Math.max(Math.min(s+.2*(Math.random()-.5),2),.5)),Math.random()<e&&(n=Math.max(Math.min(n+.2*(Math.random()-.5),2),.2)),Math.random()<e&&(a=Math.max(Math.min(a+.3*(Math.random()-.5),.9),0),a%=1),Math.random()<e&&(h=Math.max(h+.2*(Math.random()-.5),.5)),new Q(i,s,n,a,h,this.visible)}}Q.maxAccuracyLength=1.5,Q.baseWidth=.75;var j=Q;class N{constructor(t){this.canons=t,this.powerDivider=0;for(const e of t)this.powerDivider+=e.power;this.powerDivider=1+Math.log(this.powerDivider)}clone(){const t=[];for(const e of this.canons)t.push(e.clone());return new N(t)}cloneAndMutate(t){const e=t*N.canonNumberChangeChance,i=[];let s=1/(this.canons.length+1);for(const n of this.canons){const a=Math.random();a<e?a<e*s&&(i.push(n.cloneAndMutate(t)),i.push(n.cloneAndMutate(t))):i.push(n.cloneAndMutate(t))}return new N(i)}mixAndMutate(t,e){const i=[],s=(t.canons.length+this.canons.length)/2,n=Math.random()<.5?Math.floor(s):Math.ceil(s);for(let e=0;e<n;e++)this.canons[e]?t.canons[e]?i.push(Math.random()<.5?this.canons[e]:t.canons[e]):i.push(this.canons[e]):i.push(t.canons[e]);return new N(i).cloneAndMutate(e)}}N.canonNumberChangeChance=.6;const V=new N([new j(0,.75,.85,0,1,!0)]);class G extends I{constructor(t,e,i,s=V){super(t),this.radius=G.initalRadius,this.targetable=!0,this._canSleep=!1,this.unstableness=0,this.range=720,this.hue=360*Math.random(),this.tankClass=s.clone(),this.x=e,this.y=i,this.vx=0,this.vy=0,this.ax=0,this.ay=0,this.rotation=0,this.damage=G.baseDamage,this.scale=1,this.timeToQuickHeal=G.quickHealDelay,this.speed=G.baseSpeed,this.cooldownSpeed=G.initalCooldownSpeed,this.regenRate=0,this.maxHealth=G.baseMaxHealth,this.health=this.maxHealth,this.build=new Y,this.levels=new h,this.levels.onLevelUp(this.onLevelUp.bind(this))}render(t){t.translate(this.x,this.y),this.drawHPBar(t),t.lineWidth=3,t.lineJoin="round",t.rotate(this.rotation),t.fillStyle="#939393",t.strokeStyle="#6d6d6d";let e=0;for(const i of this.tankClass.canons){if(!i.visible)continue;const s=i.width*this.radius,n=i.length*this.radius;t.rotate(i.angle-e),e=i.angle,t.beginPath(),t.rect(0,-s/2,n+this.radius,s),t.fill(),t.stroke()}t.strokeStyle="hsl("+this.hue+",79%,35%)",t.fillStyle="hsl("+this.hue+",78%,49%)",t.beginPath(),t.arc(0,0,this.radius,0,2*Math.PI),t.fill(),t.stroke()}tick(t){this.doMovement(t),this.rotateToCursor(),this.fireIfShould(t),this.heal(t)}fixedTick(){this.vx*=G.fixedFriction,this.vy*=G.fixedFriction,this.vx+=this.ax*d.fixedTime*this.speed,this.vy+=this.ay*d.fixedTime*this.speed,super.fixedTick()}collideWith(t){super.collideWith(t),P(this,t)}giveXP(t){this.destoryed||this.levels.addXP(t)}destory(t){super.destory(t),R(t)&&t.giveXP(Math.min(.75*this.levels.totalXP,h.requiredForLastLevel))}onLevelUp(){this.scale=1.02**(this.levels.level-1),this.radius=this.scale*G.initalRadius}reactHit(t){super.reactHit(t),this.timeToQuickHeal=G.quickHealDelay}updateStatsWithBuild(){this.speed=G.baseSpeed*(1+.2*this.build.movementSpeed),this.cooldownSpeed=G.initalCooldownSpeed*(1-.08*this.build.reload),this.regenRate=G.baseRegenRate*this.build.healthRegeneration**1.4,this.damage=G.baseDamage*(1+this.build.bodyDamage**1.4*.1);const t=this.health/this.maxHealth;this.maxHealth=G.baseMaxHealth*(1+this.build.maxHealth**1.4*.1),this.health=this.maxHealth*t}drawHPBar(t){const e=G.hpBarLength*this.radius*2,i=-e/2,s=this.radius+G.hpBarPadding*this.radius;t.lineCap="round",t.lineWidth=G.hpBarWidth+3,t.strokeStyle="#515151",t.beginPath(),t.moveTo(i,s),t.lineTo(i+e,s),t.stroke(),t.lineWidth=G.hpBarWidth,t.strokeStyle="#83e079",t.beginPath(),t.moveTo(i,s),t.lineTo(i+e*this.health/this.maxHealth,s),t.stroke()}doMovement(t){const[e,i]=this.normalize(this.getMovement(t),1);this.ax=e,this.ay=i}rotateToCursor(){const[t,e]=this.getDirection();this.rotation=Math.atan2(e,t)}fireIfShould(t){for(const e of this.tankClass.canons){const i=e.cooldownTime*this.cooldownSpeed;if(e.warmth+=t,this.getTriggered()){const t=i*(1+e.offset);for(;e.warmth>=t;)e.warmth-=i,this.fireBullet(e)}else e.warmth>i&&(e.warmth=i)}}fireBullet(t){const e=t.width*this.radius/2,i=this.rotation+t.angle,s=t.bulletPower/this.tankClass.powerDivider,n=new W(this.game,this.x+Math.cos(i)*(this.radius+e),this.y+Math.sin(i)*(this.radius+e),.25+.03*this.build.bulletSpeed**1.4,i+(Math.random()-.5)*(this.unstableness+t.unstableness),.5+.2*this.build.bulletPenetration+.5,.5+(.5+.2*this.build.bulletDamage)*s,e,this.hue);n.setFirer(this),this.game.addEntity(n);const a=e*(1+this.build.bulletSpeed)*.0025;this.vx-=Math.cos(i)*a,this.vy-=Math.sin(i)*a}normalize(t,e=1){if(0===t[0]&&0===t[1])return[0,0];const i=Math.atan2(t[1],t[0]);return[Math.cos(i)*e,Math.sin(i)*e]}heal(t){let e;this.timeToQuickHeal-=t,e=this.timeToQuickHeal<0?.005:this.regenRate,this.health=Math.min(this.maxHealth,this.health+t*e)}}G.initalRadius=24,G.quickHealDelay=6e4,G.initalCooldownSpeed=1e3,G.baseSpeed=35e-5,G.baseRegenRate=1e-4,G.baseMaxHealth=16,G.baseDamage=.5,G.fixedFriction=.995**d.fixedTime,G.hpBarLength=1,G.hpBarWidth=4,G.hpBarPadding=.5;var J=G;class Z{constructor(t){t?(this.range=t.range,this.idealDistance=t.idealDistance,this.comfortableDistance=t.comfortableDistance,this.aggression=t.aggression,this.accuracy=t.accuracy,this.healthRegeneration=t.healthRegeneration,this.maxHealth=t.maxHealth,this.bodyDamage=t.bodyDamage,this.bulletSpeed=t.bulletSpeed,this.bulletPenetration=t.bulletPenetration,this.bulletDamage=t.bulletDamage,this.reload=t.reload,this.movementSpeed=t.movementSpeed,this.levelToReproduction=t.levelToReproduction,this.care=t.care,this.mutationRate=t.mutationRate,this.class=t.class):(this.range=Math.random(),this.idealDistance=Math.random(),this.comfortableDistance=Math.random(),this.aggression=Math.random(),this.accuracy=Math.random(),this.healthRegeneration=Math.random(),this.maxHealth=Math.random(),this.bodyDamage=Math.random(),this.bulletSpeed=Math.random(),this.bulletPenetration=Math.random(),this.bulletDamage=Math.random(),this.reload=Math.random(),this.movementSpeed=Math.random(),this.levelToReproduction=Math.random(),this.care=Math.random(),this.mutationRate=Math.random(),this.class=V)}static combineAndMutate(t,e){const i=new Z(t),s=Object.keys(i);for(const t of s)i.mixAndMutateGene(t,e[t]);return i}copyAndMutate(){const t=new Z(this),e=Object.keys(t);for(const i of e)t.mutateGene(i);return t}compare(t){const e=Object.keys(t);let i=0;for(const s of e){const e=this[s],n=t[s];if("number"==typeof e){const t=e-n;i+=t*t}}return Math.sqrt(i)}mutateGene(t){const e=this[t];"number"==typeof e?this[t]=this.calcMutateFromValue(e):"class"===t&&(this.class=this.class.cloneAndMutate(this.mutationRate))}mixAndMutateGene(t,e){const i=this[t];"number"==typeof i?this[t]=this.calcMutateFromValue((i+e)/2):"class"===t&&(this.class=i.mixAndMutate(e,this.mutationRate))}calcMutateFromValue(t){const e=this.mutationRate*Z.baseMutationRate;if(Math.random()<e){const e=t+2*(Math.random()-.5)*this.mutationRate*Z.baseMutationRate;return e>=Z.max?Z.max:e<=Z.min?Z.min:e}return t}}Z.max=.99,Z.min=.01,Z.baseMutationRate=.3;var K=Z,$=i(0),tt=i.n($);class et{constructor(){this.x=0,this.y=0,this.targetX=0,this.targetY=0}setTarget(t,e){this.targetX=t,this.targetY=e}fixedTick(){const t=this.targetX-this.x,e=this.targetY-this.y,i=Math.atan2(e,t),s=Math.min(Math.sqrt(t*t+e*e),et.maxSpeed);this.x+=Math.cos(i)*s,this.y+=Math.sin(i)*s}}et.maxSpeed=1*d.fixedTime;var it=et;class st extends J{constructor(t,e,i,s,n){super(t,e,i),this.genes=s,this.inIdealRange=!1,this.tooClose=!1,this.searchingForMate=!1,n&&(this.hue=n),this.noiseProgress=100*Math.random(),this.unstableness=1-this.genes.accuracy,this.noise=new tt.a(Math.random()*Number.MAX_SAFE_INTEGER),this.cursor=new it,this.tankClass=s.class.clone()}tick(t){this.updateTarget(),this.updateRangeStates(),super.tick(t),this.updateTeamIdIfShould(t)}fixedTick(){super.fixedTick(),this.cursor.fixedTick()}collideWith(t){t===this.mate&&this.mateWith(this.mate),super.collideWith(t)}getMovement(t){return this.mate?[this.mate.x-this.x,this.mate.y-this.y]:this.target?this.inIdealRange?this.tooClose?[this.x-this.target.x,this.y-this.target.y]:[0,0]:[this.target.x-this.x,this.target.y-this.y]:this.wander(t)}getDirection(){return this.target&&this.cursor.setTarget(this.target.x-this.x,this.target.y-this.y),[this.cursor.x,this.cursor.y]}getTriggered(){return Boolean(this.target&&this.target!=this.mate)}onLevelUp(){for(super.onLevelUp();!Y.upgrade(this.build,this.getRandomStatByGenes()););this.updateStatsWithBuild()}setMotherTeam(t,e){this.setTeamID(t),this.timeToNewTeamID=12e4*e}reactHit(t){super.reactHit(t),t.teamID!==this.teamID&&(t instanceof W?t.firer&&this.canBeTarget(t.firer)&&(this.target=t.firer):t instanceof J&&this.canBeTarget(t)&&(this.target=t))}updateTarget(){if(this.updateMate(),this.target&&this.canBeTarget(this.target))return;const t=this.game.quadTree.query(this.x,this.y,this.range*this.genes.range);let e=void 0,i=1/0;for(let s=0;s<t.length;s++){const n=t[s];if(n.teamID===this.teamID)continue;const a=n.x-this.x,h=n.y-this.y,r=a*a+h*h;r>i||(n instanceof J?Math.random()<this.genes.aggression/16&&(e=n,i=r):n.targetable&&(e=n,i=r))}this.target=e}canBeTarget(t){if(!t)return!1;const e=this.range*this.genes.range,i=t.x-this.x,s=t.y-this.y,n=i*i+s*s;return Boolean(!t.destoryed&&t.teamID!==this.teamID&&n<=e*e)}updateRangeStates(){if(!this.target)return;const t=this.x-this.target.x,e=this.y-this.target.y,i=t*t+e*e;let s=this.genes.idealDistance*this.genes.range*this.range,n=s*this.genes.comfortableDistance;s*=s,this.inIdealRange=i<s,this.tooClose=i<n}wander(t){const e=this.noise.noise2D(this.noiseProgress,this.noiseProgress),i=this.noise.noise2D(-this.noiseProgress,-this.noiseProgress);return this.noiseProgress+=1e-4*t,[e,i]}getRandomStatByGenes(){let t=0;for(const e of Y.keys)t+=this.genes[e];let e=Math.random()*t,i=0;for(const t of Y.keys)if((i+=this.genes[t])>=e)return t;throw new Error("Impossible state")}mateWith(t){const e=(t.x+this.x)/2,i=(t.y+this.y)/2,s=.3*this.genes.care+.1,n=.3*t.genes.care+.1,a=this.genes.care+t.genes.care,h=this.levels.totalXP-st.reproductionCost,r=t.levels.totalXP-st.reproductionCost,o=h*(1-s),l=r*(1-n),d=h*s+r*n;Y.reset(this.build),Y.reset(t.build),this.levels.reset(),this.levels.addXP(o),t.levels.reset(),t.levels.addXP(l);const c=new st(this.game,e,i,K.combineAndMutate(this.genes,t.genes),this.mixHue(this.hue,t.hue)+(Math.random()-.5)*st.hueVariation);c.levels.addXP(d),c.setMotherTeam(this.teamID,a),t.setMotherTeam(this.teamID,a),this.setMotherTeam(this.teamID,a),this.game.addEntity(c),this.target=void 0,this.mate=void 0,t.target=void 0,t.mate=void 0}updateMate(){if(this.mate&&!this.mate.destoryed&&this.mate.searchingForMate)return;if(this.searchingForMate=this.levels.level>=(.75*this.genes.levelToReproduction+.25)*h.maxLevel,!this.searchingForMate)return;let t;this.mate=void 0;let e=1/0;for(const i of this.game.entities)if(i!==this&&i instanceof st&&i.searchingForMate&&this.genes.compare(i.genes)<=st.maxGeneDistCompatible){const s=i.x-this.x,n=i.y-this.y,a=s*s+n*n;a<e&&(t=i,e=a)}this.mate=t}updateTeamIdIfShould(t){void 0!==this.timeToNewTeamID&&(this.timeToNewTeamID-=t,this.timeToNewTeamID<0&&(this.resetTeamId(),this.timeToNewTeamID=void 0))}mixHue(t,e){return Math.abs(t-e)<=180?(t+e)/2:(t+e)/2+180}}st.reproductionCost=h.requiredForLevel[8],st.maxGeneDistCompatible=1.6,st.hueVariation=45;var nt=st;var at=class{constructor(t,e){this.attachOnClick=!0,this.fontSize=12,this.lineHeight=1.15,this.game=t,this.engine=e,this.setup()}setup(){this.engine.onRender(()=>this.onRender()),this.engine.canvas.touchControls.onDoubleTap(()=>this.engine.attachCameraTo(void 0))}onRender(){const t=this.engine.getQuadTree().queryOne(w.x,w.y,1);T.isDown("esc")&&this.engine.attachCameraTo(void 0),t&&(this.drawDataFor(t),this.attachOnClick&&w.down&&(t!=this.lastAttachedEntity&&console.log("attach",t),this.lastAttachedEntity=t,this.engine.attachCameraTo(t)))}drawDataFor(t){const e=this.engine.canvas.getX(),i=this.getEntityDataString(t),s=[];let n=0,a=0;for(const t of i){const{width:i,height:h}=this.getTextDim(e,t,this.fontSize);s.push(i+12),n+=i+12,a=Math.max(h,a)}e.font=this.fontSize+"px Ubuntu, Arial",e.textBaseline="top",e.save(),this.engine.camera.applyTranslateOnly(e),e.translate(t.x*this.engine.camera.scale,t.y*this.engine.camera.scale),e.beginPath(),e.lineWidth=2,e.fillStyle="#ababab88",e.strokeStyle="#333333aa",e.rect(0,0,n+8,a+8),e.fill(),e.stroke(),e.fillStyle="#000000",e.translate(4,4);for(let t=0;t<i.length;t++)this.writeText(e,i[t],this.fontSize),e.translate(s[t],0);e.restore()}writeText(t,e,i){const s=e.split("\n");let n=0;for(;n<s.length;n++)t.fillText(s[n],0,n*(i*this.lineHeight))}getTextDim(t,e,i){const s=e.split("\n");let n=0,a=0;for(const e of s)n+=i*this.lineHeight,a=Math.max(a,t.measureText(e).width);return{width:a,height:n-i*(this.lineHeight-1)}}getEntityDataString(t){return t instanceof nt?[["Genetic Tank","TeamID: "+t.teamID,"TimeToNewTeam: "+(t.timeToNewTeamID&&Math.floor(t.timeToNewTeamID)),"Level: "+t.levels.level,"TotalXP: "+this.round(t.levels.totalXP,10),"IsSearchingForMate: "+t.searchingForMate.toString(),"","--- Build ---",this.buildToString(t.build)].join("\n"),["--- Genes ---",this.genesToString(t.genes)].join("\n"),["Number of canons: "+t.tankClass.canons.length,"Power divisor: "+this.round(t.tankClass.powerDivider,1e3)].join("\n")]:t instanceof W?[["Bullet","TeamID: "+t.teamID,"TTL: "+Math.floor(t.ttl),"Health: "+this.round(t.health,10),"Damage: "+this.round(t.damage,10),"Damage on hit: "+this.round(t.health*t.damage,10)].join("\n")]:t instanceof L?[["Polygon","Health: "+this.round(t.health,10),"Sleeping: "+t._sleeping.toString()].join("\n")]:[t.constructor.name+"\nTeamID: "+t.teamID]}genesToString(t){const e=Object.keys(t).sort();let i=[];for(const s of e){const e=t[s];"number"==typeof e?i.push(s+": "+this.round(e,100)):i.push(s+": ["+e.constructor.name+"]")}return i.join("\n")}buildToString(t){const e=[];for(const i of Y.keys)e.push(i+": "+t[i]);return e.join("\n")}round(t,e){return Math.round(t*e)/e}};var ht=class extends J{constructor(t,e,i){super(t,e,i)}updateStatsWithBuild(){super.updateStatsWithBuild()}getMovement(){let t=0,e=0;return T.isDown("w")&&(e-=1),T.isDown("s")&&(e+=1),T.isDown("a")&&(t-=1),T.isDown("d")&&(t+=1),[t,e]}getDirection(){return[w.x-this.x,w.y-this.y]}getTriggered(){return w.down}};class rt{constructor(t){this.startTime=performance.now(),this.entities=[],this.config=t,this.initalTanks=t.initalTanks,this.maintainTanks=t.maintainTanks,this.targetEntities=t.targetEntities,this.size=t.size,this.spawnrates=this.createSpawnrates(t),this.engine=new k(this.entities),this.boundaries=new F(this.size,this.size),this.engine.setBoundaries(this.boundaries),this.quadTree=this.engine.getQuadTree(),this.dataViewer=new at(this,this.engine),t.player.beInTheGame&&this.createPlayer(),this.engine.debugDrawHitCircles=t.debug.drawHitCircles,this.engine.debugRenderQuadTree=t.debug.drawQuadTree,this.setup(),this.transitionIn()}setup(){this.populateInital(),this.reqanf()}appendTo(t){this.engine.appendTo(t)}addEntity(t){this.entities.push(t),this.engine.newEntity(t)}thanosSnap(){for(const t of this.entities)Math.random()<.5&&t.destory()}pause(){this.engine.pause()}resume(){this.engine.resume()}transitionIn(){this.engine.camera.gotoNoTransition(this.size/2,this.size/2,2*Math.max(innerWidth,innerHeight)),setTimeout(()=>this.engine.camera.goto(this.size/2,this.size/2,1),rt.titleDelay)}reqanf(){const t=performance.now()-this.startTime;this.engine.render(),this.createShapesToTarget(),this.maintainTankNumbers(),t<rt.titleDelay&&this.drawName(t),requestAnimationFrame(this.reqanf.bind(this))}createSpawnrates(t){let e=t.spawnRates.square+t.spawnRates.triangle+t.spawnRates.pentagon;return[[_,t.spawnRates.square/e],[z,t.spawnRates.triangle/e],[B,t.spawnRates.pentagon/e]]}drawName(t){const e=this.engine.canvas.getX(),i=this.engine.canvas.width/2,s=this.engine.canvas.height/2;e.save(),e.globalAlpha=Math.min(2*(1-t/rt.titleDelay),1),e.textBaseline="middle",e.textAlign="center",e.font=Math.min(.06*innerWidth,64)+"px Ubuntu, Arial",e.fillStyle="#000000",e.fillText("diep.io Genetic Evolution Simulator",i,s),e.restore()}createShapesToTarget(){let t=this.entities.length;for(;t<this.targetEntities;t++)this.spawnShape()}maintainTankNumbers(){let t=0;for(const e of this.entities)if(e instanceof J&&++t>=this.maintainTanks)return;for(;t<this.maintainTanks;t++)this.addEntity(new nt(this,Math.random()*this.boundaries.width,Math.random()*this.boundaries.height,new K))}spawnShape(){const t=Math.random();let e=0;for(const[i,s]of this.spawnrates)if(t<(e+=s)){this.addEntity(new i(this,Math.random()*this.boundaries.width,Math.random()*this.boundaries.height));break}}populateInital(){for(let t=0;t<this.initalTanks;t++)this.addEntity(new nt(this,Math.random()*this.boundaries.width,Math.random()*this.boundaries.height,new K))}createPlayer(){const t=new ht(this,this.boundaries.width/2,this.boundaries.height/2);for(const e of Y.keys)t.build[e]=this.config.player.build[e];t.levels.addXP(h.requiredForLevel[this.config.player.level]||0),t.updateStatsWithBuild(),this.dataViewer.attachOnClick=!1,this.engine.attachCameraTo(t),this.addEntity(t)}}rt.titleDelay=2e3;var ot=rt;const lt=document.title,dt=document.createElement("div");dt.classList.add("message");const ct=new n("Config",new r);function ut(t){t?(dt.innerText=t,document.body.appendChild(dt)):document.body.removeChild(dt)}ct.appendTo(document.body),ct.setInvalidSubmitionHandler(()=>alert("Invalid config!")),ct.setSubmitHandler(t=>{ut("Creating inital entities..."),ct.changed&&ct.saveConfigToLocalStorage(),setTimeout(()=>{!function(t){document.body.scrollTop=document.documentElement.scrollTop=0,document.body.classList.add("noScroll"),ct.remove(),e=document.getElementById("controls"),e.parentElement.removeChild(e),ut();var e;const i=new ot(t);i.appendTo(document.body),document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState?(document.title=lt,i.resume()):(document.title="[Paused] "+lt,i.pause())}),window.game=i}(t)},1)}),ut("Adjust the settings if the simulation runs too slowly")}]);